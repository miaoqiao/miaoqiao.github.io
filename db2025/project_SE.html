<!DOCTYPE html>
<html lang="en" xmlns:og="https://ogp.me/ns#" xmlns:fb="https://www.facebook.com/2008/fbml"><head>


    <title>Project #1 - Buffer Pool Manager </title>
</head>

<body class="min-vh-100 d-flex flex-column h-100">
    <!-- BEGIN: header -->
<!-- <header>
  <nav class="navbar fixed-top navbar-expand-md bg-black navbar-dark" aria-label="Navigation Menu">
    <div class="container">
      <a class="navbar-brand" onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/spring2025"><img src="Project%20%231%20-%20Buffer%20Pool%20Manager%20_%20CMU%2015-445_645%20__%20Intro%20to%20Database%20Systems%20(Spring%202025)_files/cmudb-icon-white.svg" width="24"> CMU 15-445/645</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="navbar">
        <ul class="navbar-nav me-auto mb-0 text-uppercase">
              <li class="nav-item px-xl-4 px-md-1">
                <a class="nav-link " onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/spring2025/assignments.html">Assignments</a>
              </li>
              <li class="nav-item px-xl-4 px-md-1">
                <a class="nav-link " onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/spring2025/faq.html">FAQ</a>
              </li>
              <li class="nav-item px-xl-4 px-md-1">
                <a class="nav-link " onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/spring2025/schedule.html">Schedule</a>
              </li>
              <li class="nav-item px-xl-4 px-md-1">
                <a class="nav-link " onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/spring2025/syllabus.html">Syllabus</a>
              </li>
        </ul>

        <ul class="navbar-nav ms-auto mb-0 text-uppercase">
          <li class="nav-item px-md-1"> <a class="nav-link" title="Piazza" onclick="javascript:pageTracker._trackPageview('/outgoing/piazza.com');" href="https://piazza.com/cmu/spring2025/15445645" target="_pz"><i class="fas fa-comments"></i> Piazza</a>
        </li></ul>
      </div>
    </div>
  </nav>
</header -->    <!-- END: header -->

    <main class="flex-shrink-0 page">
        <!-- BEGIN: banner -->
<!-- Empty space -->
<!--<div class="container mt-5">
    <div class="row">
    </div>
</div>-->
        <!-- END: banner -->
        <!-- BEGIN: main -->
        <div class="container main-content rounded mb-0 mb-lg-5 mt-0 mt-sm-3 mt-md-4 mt-lg-5 py-4 px-md-5 shadow-sm bg-light content">
<h1 class="page-header"><i class="fas fa-database"></i> <span class="text-uppercase">Project #1 - Buffer Pool Manager</span>
    <span class="fw-normal fs-6 float-end mt-2 text-muted published d-none d-lg-inline" style="font-family: sans; letter-spacing: normal;">
        <i class="fa fa-calendar"></i>
        <!-- <time datetime="2025-01-23 10:49:55.184781-05:00">Last Updated: Jan 23, 2025</time> -->
    </span>
</h1>
<div class="row pb-3 d-block d-lg-none">
    <div class="col-12 text-start text-muted published">
        <i class="fa fa-calendar"></i>
        <!-- <time datetime="2025-01-23 10:49:55.184781-05:00">Last Updated: Jan 23, 2025</time> -->
    </div>
</div>
<p class="warning bg-danger text-white p-2 rounded fw-bold">
    <i class="trigger fa fa-exclamation-triangle fa-lg p-1 pe-lg-2"></i>
    Do <u>not</u> post your project on a public Github repository.
</p>

<!-- ========================================================================= -->
<!-- OVERVIEW                                                                  -->
<!-- ========================================================================= -->

<h1>Overview</h1>
<p>This semester, you will start building a <em>disk-oriented database management system</em> (DBMS) called <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub">BusTub</a>. The project is a part of <a href = https://15445.courses.cs.cmu.edu/spring2025> CMU database course</a>.
 A disk-oriented architecture means that the DBMS's primary storage 
location is in persistent storage, like a hard drive (HDD) or flash 
storage (SSDs). This is different from an in-memory DBMS, where data is 
stored in volatile memory.</p>
<p>This programming project is to implement the DBMS's <strong>buffer pool manager.</strong>
 The buffer pool is responsible for moving physical pages of data back 
and forth from buffers in main memory to persistent storage. It also 
behaves as a cache, keeping frequently used pages in memory for faster 
access, and evicting unused or cold pages back out to storage.</p>
<p>A <em>page</em> in BusTub is 4096 bytes (4 KB) of data, meaning the 
buffer pool manages data in 4 KB units. Since pages in BusTub have a 
fixed size, the buffer pool manager stores these pages into fixed-size 
buffers called <em>frames</em>. The distinction between a page and a frame is somewhat subtle. A <em>page</em> is 4 KB of logical (virtual) data, and can be stored in memory, on disk, or both in memory and on disk. A <em>frame</em>,
 on the other hand, is a fixed-length 4 KB block of memory (i.e., a 
pointer to this memory) that stores a single page of data. The analogy 
here is storing (logical) pages <em>inside</em> (physical) fixed frames.</p>
<p>In addition to behaving as a cache, the buffer pool manager allows a 
DBMS to support databases that are larger than the amount of memory 
available to the system. Consider a computer with 1 GB of memory (RAM). 
If we want to manage a 2 GB database, a buffer pool manager gives us the
 ability to interact with this database <em>without</em> needing to fit its entire contents in memory.</p>
<p>The I/O operations that the buffer pool executes are abstracted away 
from other parts of the DBMS. For example, when one of the DBMS's 
components (e.g., execution engine) asks the buffer pool manager for a 
page of data using its unique identifier (<code>page_id_t</code>), that 
component does not need to know whether that page is already in memory 
or whether the system has to retrieve it from disk. Similarly, the 
buffer pool manager does not need to understand the contents of these 
pages, it only needs to know where the data is located.</p>
<h3>Implementation</h3>
<p><strong>Your implementation of the buffer pool must be thread-safe.</strong>
 Multiple threads will concurrently access the internal data structures 
of your buffer pool, and you must make sure that critical sections are 
protected with <a onclick="javascript:pageTracker._trackPageview('/outgoing/stackoverflow.com');" href="https://stackoverflow.com/a/42464336">latches</a> (these are called "locks" in operating systems). </p>
<p>You must implement the following storage manager components:</p>
<ul>
    <li> <a href="#lru-k-replacer"><b>LRU-K Replacement Policy</b></a> </li>
    <li> <a href="#disk-scheduler"><b>Disk Scheduler</b></a> </li>
    <li> <a href="#buffer-pool-manager"><b>Buffer Pool Manager</b></a> </li>
</ul>

<p><strong>This is a single-person project that must be completed individually (i.e., no groups).</strong></p>
<!-- START project1 -->
<!-- AUTO-GENERATED BY GENERATE-SCHEDULE SCRIPT -->
<!-- ANY MODIFICATIONS WILL BE OVERWRITTEN -->
<ul>
<!-- <li><b>Release Date:</b> Jan 22, 2025</li> -->
<li><b>Due Date:</b> May 18, 2025 @ 11:59pm</li>
</ul>
<!-- END project1 -->

<!-- ========================================================================= -->
<!-- PROJECT SPECIFICATION                                                     -->
<!-- ========================================================================= -->
<h1>Project Specification</h1>
<p class="warning bg-danger text-white p-2 rounded fw-bold">
    <i class="trigger fa fa-exclamation-triangle fa-lg p-1 pe-lg-2"></i>
    Remember to pull latest code from the BusTub repository.
</p>

<p>For each of the following components, we have provided stub classes that contain the API that you must implement. You should <b><u>not</u></b>
 modify the signatures for the pre-defined functions in these classes. 
If you modify the signatures, our grading test code will not work and 
you will not get credit for this project.</p>
<p>If a class already contains data members, you should not remove them. For example, the <code>BufferPoolManager</code> class contains <code>DiskScheduler</code> and <code>LRUKReplacer</code> members that are required to implement functionality needed by the rest of the system. <strong>You may add data members and helper functions to these classes</strong> to correctly implement the required functionality.</p>
<p>You may use any built-in <a onclick="javascript:pageTracker._trackPageview('/outgoing/en.cppreference.com');" href="http://en.cppreference.com/w/cpp/container">C++17 containers</a>
 in your project unless specified otherwise. It is up to you to decide 
which ones you want to use. Be warned that these containers are not 
thread-safe, and you will need to use latches to protect access to them.
 <strong>You may <u>not</u> use additional third-party libraries (e.g., <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.boost.org');" href="https://www.boost.org/">Boost</a>).</strong></p>
<!-- **************************************************** -->
<!-- LRU-K Replacement Policy                             -->
<!-- **************************************************** -->

<h2 class="task" id="lru-k-replacer">Task #1 - LRU-K Replacement Policy</h2>

<p>This component is responsible for tracking page usage in the buffer 
pool in order to determine candidate pages / frames to evict out of 
memory and back to disk.</p>
<p>You will implement a class called <code>LRUKReplacer</code> in <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/buffer/lru_k_replacer.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/buffer/lru_k_replacer.h</tt> <i class="fas fa-external-link-alt"></i></a> and its corresponding implementation file in <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/buffer/lru_k_replacer.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/buffer/lru_k_replacer.cpp</tt> <i class="fas fa-external-link-alt"></i></a>. Note that <code>LRUKReplacer</code> is a standalone class and is <b><u>not</u></b> related to any of the other <code>Replacer</code>
 classes. You are only expected to implement the LRU-K replacement 
policy, and you don't have to implement the LRU or Clock replacement 
policy (even though there is a corresponding file for it).</p>
<p><strong>The LRU-K algorithm evicts a frame whose backward <em>k-distance</em> is the maximum of all frames in the replacer.</strong>
 Backward k-distance is computed as the difference in time between the 
current timestamp and the timestamp of kth previous access. A frame with
 fewer than k historical accesses is given +inf as its backward 
k-distance. If multiple frames have +inf backward k-distance, the 
replacer evicts the frame with the earliest overall timestamp (i.e., the
 frame whose least-recent recorded access is the overall least recent 
access).</p>
<p>The maximum size of the <code>LRUKReplacer</code> is the same as the size of the buffer pool since it contains placeholders for all of the frames in the <code>BufferPoolManager</code>. However, not all frames in the replacer may be considered as evictable at any given time. The size of <code>LRUKReplacer</code> is represented by the number of <em>evictable</em> frames. The <code>LRUKReplacer</code>
 is first initialized to have no frames in it. Only when a frame is 
marked as evictable will replacer's size will increase. Similarly, when a
 frame is pinned or not in use, the replacer's size will decrease.</p>
<p>You will need to implement the following methods for LRU-K as defined in the header file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/buffer/lru_k_replacer.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/buffer/lru_k_replacer.h</tt> <i class="fas fa-external-link-alt"></i></a>) and in the source file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/buffer/lru_k_replacer.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/buffer/lru_k_replacer.cpp</tt> <i class="fas fa-external-link-alt"></i></a>):</p>
<ul>
    <li>
        <code>Evict() -&gt; std::optional&lt;frame_id_t&gt;</code> : Evict the frame that has the largest backward k-distance compared to all other <b>evictable</b> frames being tracked by the <code>Replacer</code>. If there are no evictable frames, return <code>std::nullopt</code>.
    </li>
    <li>
        <code>RecordAccess(frame_id_t frame_id)</code> : Record that the
 given frame has been accessed at the current timestamp. This method 
should be called after a page has been pinned in the <code>BufferPoolManager</code>.
    </li>
    <li>
        <code>Remove(frame_id_t frame_id)</code> : Clear all access history associated with a frame. This method should be called only when a page is deleted in the <code>BufferPoolManager</code>.
    </li>
    <li>
        <code>SetEvictable(frame_id_t frame_id, bool set_evictable)</code> : This method controls whether a frame is evictable or not. It also controls the <code>LRUKReplacer</code>'s size. You'll know when to call this function when you implement the <code>BufferPoolManager</code>. To be specific, <b>when the pin count of a page hits 0, its corresponding frame should be marked as evictable.</b>
    </li>
    <li>
        <code>Size() -&gt; size_t</code> : This method returns the number of evictable frames that are currently in the <code>LRUKReplacer</code>.
    </li>
</ul>

<p>The implementation details are up to you. You are allowed to use 
built-in STL containers. You may assume that you will not run out of 
memory for these data structures (<strong>you cannot assume the same for the buffer pool in Task #3, you <em>will</em> run out of available frames</strong>). You must make sure that your implementation is thread-safe.</p>
<p>If you would like to read more about the LRU-K replacement algorithm, refer to this <a onclick="javascript:pageTracker._trackPageview('/downloads/~natassa/courses/15-721/papers/p297-o_neil.pdf');" href="https://www.cs.cmu.edu/~natassa/courses/15-721/papers/p297-o_neil.pdf">paper</a>.</p>
<!-- **************************************************** -->
<!-- Disk Scheduler                             -->
<!-- **************************************************** -->

<h2 class="task" id="disk-scheduler">Task #2 - Disk Scheduler</h2>

<p>This component is responsible for scheduling read and write operations on the <code>DiskManager</code>. You will implement a class called <code>DiskScheduler</code> in <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/disk/disk_scheduler.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/storage/disk/disk_scheduler.h</tt> <i class="fas fa-external-link-alt"></i></a> and its corresponding implementation file in <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/storage/disk/disk_scheduler.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/storage/disk/disk_scheduler.cpp</tt> <i class="fas fa-external-link-alt"></i></a>.</p>
<p>The disk scheduler can be used by other components (in this case, your <code>BufferPoolManager</code> in Task #3) to queue disk requests, represented by a <code>DiskRequest</code> struct (already defined in <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/disk/disk_scheduler.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/storage/disk/disk_scheduler.h</tt> <i class="fas fa-external-link-alt"></i></a>). The disk scheduler will maintain a background worker thread which is responsible for processing scheduled requests.</p>
<p>The disk scheduler will utilize a shared queue (channel) to schedule and process the <code>DiskRequest</code>s.
 One thread will add a request to the queue, and the disk scheduler's 
background worker will process the queued requests. We have provided a <code>Channel</code> class in <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/common/channel.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/common/channel.h</tt> <i class="fas fa-external-link-alt"></i></a>
 to facilitate the thread-safe sharing of data between threads, but feel
 free to use your own implementation if you find it necessary.</p>
<p>The <code>DiskScheduler</code> constructor and destructor are already
 implemented and are responsible for creating and joining the background
 worker thread. You will only need to implement the following methods as
 defined in the header file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/disk/disk_scheduler.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/storage/disk/disk_scheduler.h</tt> <i class="fas fa-external-link-alt"></i></a>) and in the source file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/storage/disk/disk_scheduler.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/storage/disk/disk_scheduler.cpp</tt> <i class="fas fa-external-link-alt"></i></a>):</p>
<ul>
    <li>
        <code>Schedule(DiskRequest r)</code> : Schedules a request for the <code>DiskManager</code> to execute. The <code>DiskRequest</code>
 struct specifies whether the request is for a read or write, where the 
data should be read from / written into, and the page ID for the 
operation. The <code>DiskRequest</code> also includes a <code>std::promise</code> whose value should be set to true once the request is processed. See below for more information about <code>std::promise</code>.
    </li>
    <li>
        <code>StartWorkerThread()</code> : The startup method for the 
background worker thread which processes the scheduled requests. The 
worker thread is created in the <code>DiskScheduler</code> constructor and calls this method. This worker thread is responsible for receiving queued requests and dispatching them to the <code>DiskManager</code>. Remember to set the value correctly on the <code>DiskRequest</code>'s callback to signal to the request issuer that the request has been completed. This should not return until the <code>DiskScheduler</code>'s destructor is called.
    </li>
</ul>

<p>We mentioned that one of the fields of a <code>DiskRequest</code> is a <code>std::promise</code>. If you are unfamiliar with C++ promises and futures, you can check out the documentation <a onclick="javascript:pageTracker._trackPageview('/outgoing/en.cppreference.com');" href="https://en.cppreference.com/w/cpp/thread/promise">here</a>.
 For the purposes of this project, they essentially provide a callback 
mechanism for a thread to know when their scheduled request is 
completed. To see an example of how they might be used, check out <code>disk_scheduler_test.cpp</code>.</p>
<p>Again, the implementation details are up to you. You must make sure that your implementation is thread-safe.</p>
<h3>Disk Manager</h3>

<p>The header containing the <code>DiskManager</code> class is located at (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/disk/disk_manager.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/storage/disk/disk_manager.h</tt> <i class="fas fa-external-link-alt"></i></a>). It reads page data from disk and writes data to disk. Your disk scheduler will use <code>DiskManager::ReadPage()</code> and <code>DiskManager::WritePage()</code> while it is processing a read or write request.</p>
<!-- **************************************************** -->
<!-- Buffer Pool Manager                                  -->
<!-- **************************************************** -->

<h2 class="task" id="buffer-pool-manager">Task #3 - Buffer Pool Manager</h2>

<p>Finally, you must implement the buffer pool manager (<code>BufferPoolManager</code>)! Echoing the beginning of this page, the <code>BufferPoolManager</code> is responsible for fetching database pages from disk with the <code>DiskScheduler</code> and storing them in memory. The <code>BufferPoolManager</code>
 can also schedule writes of dirty pages out to disk when it is either 
explicitly instructed to do so or when it needs to evict a page to make 
space for a new page.</p>
<p>Your <code>BufferPoolManager</code> implementation will use the <code>LRUKReplacer</code> and <code>DiskScheduler</code> classes that you created in the previous steps of this assignment. The <code>LRUKReplacer</code>
 will keep track of when pages are accessed so that it can decide which 
frame to evict when it must make room for a new page. The <code>DiskScheduler</code> will schedule writes and reads to disk on the <code>DiskManager</code>.</p>
<p>We have provided a helper class called <code>FrameHeader</code>, which helps manage the in-memory frames. All access to page data should be through <code>FrameHeader</code>s. <code>FrameHeader</code> has a method called <code>GetData</code> that returns a raw pointer to its frame's memory, and the <code>DiskScheduler</code> / <code>DiskManager</code> will use this pointer to copy the contents of a physical page on disk into memory.</p>
<p>As a reminder, the buffer pool manager does not need to understand the contents of these pages. The only information that the <code>BufferPoolManager</code> knows about pages are the page IDs (<code>page_id_t</code>) and the <code>FrameHeader</code>s they are stored inside of. Also, the <code>BufferPoolManager</code> will reuse the same <code>FrameHeader</code> object to store data as it moves back and forth between disk and memory. In other words, all <code>FrameHeader</code>s will store many different pages throughout the lifetime of the system.</p>
<h3>Concurrency</h3>
<p>When implementing a multi-threaded buffer pool manager, we must take 
care to synchronize data access. This means that we do not want multiple
 copies of the same page in different frames of the buffer pool. If we 
allowed this, we would encounter this scenario:</p>
<ul>
<li>Thread T<sub>1</sub> loads page X<sub>1</sub> from disk into a frame and starts modifying page X<sub>1</sub>, and let's call this new version page X<sub>2</sub>.</li>
<li>Thread T<sub>2</sub> loads page X<sub>1</sub> from disk into a different frame and starts modifying this version of page X<sub>1</sub>, and let's call this other modified version page X<sub>3</sub>.</li>
<li>Thread T<sub>2</sub> finishes writing and writes X<sub>3</sub> back to disk.</li>
<li>Thread T<sub>1</sub> finishes writing and writes X<sub>2</sub> back to disk.</li>
<li>Data race ☠️!</li>
</ul>
<p>Thus, we keep only 1 version of a page in memory at a time to prevent
 data synchronization races. Additionally, to prevent us from evicting a
 page while threads are accessing it, we maintain a reference count / 
pin count on the frame that stores it. Finally, in order to keep track 
of which pages are stored in which frames, we also maintain a page table
 using a hash map that maps page IDs to frames.</p>
<p>The pin count of a frame is the number of threads that have access to
 the page's data. As long as the pin count on a frame is greater than 0 
(implying there is at least 1 thread accessing the page's data), the 
buffer pool manager is not allowed to evict the page being stored. You 
can maintain the pin count using the atomic field <code>pin_count_</code> in the <code>FrameHeader</code> class. Keep in mind that <code>pin_count_</code> is separate from <code>LRUKReplacer::SetEvictable</code>, so you will need to make sure those are synced properly. You will also have to update the <code>is_dirty_</code> flag of the <code>FrameHeader</code>
 when you think it is necessary. If this flag is set when you want to 
evict a page, you will have to act accordingly to maintain data 
synchronization between memory and disk.</p>
<p>Last, but certainly not least, you will have to implement both <code>ReadPageGuard</code> and <code>WritePageGuard</code>.
 These classes are RAII objects that provide thread-safe read / write 
access to the underlying pages. See the implementation section below for
 more information. You will probably need to implement this in tandem 
with the <code>BufferPoolManager</code> methods <code>CheckedReadPage</code> and <code>CheckedWritePage</code>. However, if you want to make sure your page guard implementations are correct, you may choose to implement <code>BufferPoolManager::GetPinCount</code> first and then stitch together something that will pass the page guard tests.</p>
<h3>Implementation</h3>
<p>You will need to implement the following page guard methods defined in the header file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/storage/page/page_guard.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/storage/page/page_guard.h</tt> <i class="fas fa-external-link-alt"></i></a>) and in the source file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/storage/page/page_guard.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/storage/page/page_guard.cpp</tt> <i class="fas fa-external-link-alt"></i></a>):</p>
<ul>
    <li> <code>ReadPageGuard::ReadPageGuard()</code> </li>
    <li> <code>ReadPageGuard::ReadPageGuard(ReadPageGuard &amp;&amp;that)</code> </li>
    <li> <code>ReadPageGuard::operator=(ReadPageGuard &amp;&amp;that) -&gt; ReadPageGuard &amp;</code> </li>
    <li> <code>ReadPageGuard::Flush()</code> </li>
    <li> <code>ReadPageGuard::Drop()</code> </li>
    <li> <code>WritePageGuard::WritePageGuard()</code> </li>
    <li> <code>WritePageGuard::WritePageGuard(WritePageGuard &amp;&amp;that)</code> </li>
    <li> <code>WritePageGuard::operator=(WritePageGuard &amp;&amp;that) -&gt; WritePageGuard &amp;</code> </li>
    <li> <code>WritePageGuard::Flush()</code> </li>
    <li> <code>WritePageGuard::Drop()</code> </li>
</ul>

<p><strong>You <em>do not</em> have to implement these methods <em>before</em> the <code>BufferPoolManager</code> methods. You should probably work on them at the same time.</strong></p>
<p>These methods implement move semantics and RAII for the page guards. 
If you are unfamiliar with these things, please familiarize yourself 
with learning materials online. There are many great resources 
(including articles, Microsoft tutorials, YouTube videos) that explain 
this in depth. <strong>You should not attempt to implement these methods without having a solid understanding of how RAII and move semantics work.</strong></p>
<p>There will likely be a lot of code duplication here (i.e. the two 
guards should be identical except for a handful of lines). If you want 
to derive these classes based on a class you create, you are welcome to 
do so. Just make sure that no interfaces and method signatures are 
changed!</p>
<p>You will also need to implement the following <code>BufferPoolManager</code> methods defined in the header file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/include/buffer/buffer_pool_manager.h" target="_bustub" class="filepath" title="View Source Code"><tt>src/include/buffer/buffer_pool_manager.h</tt> <i class="fas fa-external-link-alt"></i></a>) and in the source file (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/buffer/buffer_pool_manager.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/buffer/buffer_pool_manager.cpp</tt> <i class="fas fa-external-link-alt"></i></a>):</p>
<ul>
    <li> <code>NewPage() -&gt; page_id_t</code> </li>
    <li> <code>DeletePage(page_id_t page_id) -&gt; bool</code> </li>
    <li> <code>CheckedWritePage(page_id_t page_id) -&gt; std::optional&lt;WritePageGuard&gt;</code> </li>
    <li> <code>CheckedReadPage(page_id_t page_id) -&gt; std::optional&lt;ReadPageGuard&gt;</code> </li>
    <li> <code>FlushPageUnsafe(page_id_t page_id) -&gt; bool</code> </li>
    <li> <code>FlushPage(page_id_t page_id) -&gt; bool</code> </li>
    <li> <code>FlushAllPagesUnsafe()</code> </li>
    <li> <code>FlushAllPages()</code> </li>
    <li> <code>GetPinCount(page_id_t page_id)</code> </li>
</ul>

<p><strong>All of these methods have detailed documentation comments in 
the source file. Make sure to read all of these in their entirety! They 
will contain many useful hints.</strong></p>
<p>You do not need to make your buffer pool manager super efficient. For all of the public <code>BufferPoolManager</code> method, holding the buffer pool latch from beginning to end should be enough (<strong>except for when you need to release it early to prevent deadlocks</strong>).
 However, you do need to ensure that your buffer pool manager has 
reasonable performance, otherwise there will be problems in future 
projects. You can compare your benchmark result (QPS.1 and QPS.2) with 
other students and see if your implementation is too slow.</p>
<p>Please refer to the source files (<a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/storage/page/page_guard.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/storage/page/page_guard.cpp</tt> <i class="fas fa-external-link-alt"></i></a> and <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/src/buffer/buffer_pool_manager.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>src/buffer/buffer_pool_manager.cpp</tt> <i class="fas fa-external-link-alt"></i></a>) for <em>significantly</em> more detailed specifications and documentation.</p>
<!-- **************************************************** -->
<!-- Leaderboard                                          -->
<!-- **************************************************** -->

<!-- ========================================================================= -->
<!-- INSTRUCTIONS                                                              -->
<!-- ========================================================================= -->
<h1 id="instructions">Instructions</h1>

<h2>Creating Your Own Project Repository</h2>
<p>If the below <code>git</code> concepts (e.g., repository, merge, pull, fork) do not make sense to you, please spend some time <a onclick="javascript:pageTracker._trackPageview('/outgoing/guides.github.com');" href="https://guides.github.com/introduction/git-handbook/">learning git</a> first.</p>
<p>Follow the <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub#cloning-this-repository">instructions</a>
 to setup your own PRIVATE repository and your own development branch. 
If you have previuosly forked the repository through the GitHub UI (by 
clicking Fork), PLEASE DO NOT PUSH ANY CODE TO YOUR PUBLIC FORKED 
REPOSITORY! Make sure your repository is PRIVATE before you <code>git push</code> any of your code.</p>
<p>If the instructor makes any changes to the code, you can merge the 
changes to your code by keeping your private repository connected to the
 CMU-DB master repository. Execute the following commands to add a 
remote source:</p>
<pre class="border border-2 shadow-sm p-2">$ git remote add public https://github.com/cmu-db/bustub.git
</pre>

<p>You can then pull down the latest changes as needed during the semester:</p>
<pre class="border border-2 shadow-sm p-2">$ git fetch public
$ git merge public/master
</pre>

<h2>Setting Up Your Development Environment</h2>
<p>First install the packages that BusTub requires:</p>
<pre class="border border-2 shadow-sm p-2"># Linux
$ sudo build_support/packages.sh
# macOS
$ build_support/packages.sh
</pre>

<p>See the <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/README.md">README</a> for additional information on how to setup different OS environments.</p>
<p>To build the system from the commandline, execute the following commands:</p>
<pre class="border border-2 shadow-sm p-2">$ mkdir build
$ cd build
$ cmake -DCMAKE_BUILD_TYPE=Debug ..
$ make -j`nproc`
</pre>

<!-- <p>See the <a href="https://15445.courses.cs.cmu.edu/spring2025/project0/#instructions">Project #0 instructions</a> on how to create your private repository and setup your development environment.</p> -->


<h2>Testing</h2>
<p>You can test the individual components of this assigment using our testing framework. We use <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/google/googletest">GTest</a> for unit test cases. There are three separate files that contain tests for each component:</p>
<ul>
    <li><code>LRUKReplacer</code>: <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/test/buffer/lru_k_replacer_test.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>test/buffer/lru_k_replacer_test.cpp</tt> <i class="fas fa-external-link-alt"></i></a>
    </li><li><code>DiskScheduler</code>: <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/test/storage/disk_scheduler_test.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>test/storage/disk_scheduler_test.cpp</tt> <i class="fas fa-external-link-alt"></i></a>
    </li><li><code>PageGuard</code>: <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/test/storage/page_guard_test.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>test/storage/page_guard_test.cpp</tt> <i class="fas fa-external-link-alt"></i></a>
    </li><li><code>BufferPoolManager</code>: <a onclick="javascript:pageTracker._trackPageview('/outgoing/github.com');" href="https://github.com/cmu-db/bustub/blob/master/test/buffer/buffer_pool_manager_test.cpp" target="_bustub" class="filepath" title="View Source Code"><tt>test/buffer/buffer_pool_manager_test.cpp</tt> <i class="fas fa-external-link-alt"></i></a>
</li></ul>

<p>You can compile and run each test individually from the command-line:</p>
<pre class="border border-2 shadow-sm p-2">$ make lru_k_replacer_test -j `nproc`
$ ./test/lru_k_replacer_test
</pre>

<p>You can also run <code>make check-tests</code> to run ALL of the test
 cases. Note that some tests are disabled as you have not implemented 
future projects. You can disable tests in GTest by adding a <code>DISABLED_</code> prefix to the test name.</p>
<p><b>Important:</b> These tests are only a subset of the all the tests 
that we will use to evaluate and grade your project. You should write 
additional test cases on your own to check the complete functionality of
 your implementation.</p>
<h2>Formatting</h2>
<p>Your code must follow the <a onclick="javascript:pageTracker._trackPageview('/outgoing/google.github.io');" href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide</a>. We use <a onclick="javascript:pageTracker._trackPageview('/outgoing/clang.llvm.org');" href="https://clang.llvm.org/">Clang</a> to automatically check the quality of your source code. Your project grade will be <u><b>zero</b></u> if your submission fails any of these checks.</p>
<p>Execute the following commands to check your syntax. The <code>format</code> target will automatically correct your code. The <code>check-lint</code> and <code>check-clang-tidy-p1</code> targets will print errors and instruct you how to fix it to conform to our style guide.</p>
<pre class="border border-2 shadow-sm p-2">$ make format
$ make check-clang-tidy-p1
</pre>

<h2>Memory Leaks</h2>
<p>For this project, we use <a onclick="javascript:pageTracker._trackPageview('/outgoing/clang.llvm.org');" href="https://clang.llvm.org/docs/AddressSanitizer.html">LLVM Address Sanitizer (ASAN) and Leak Sanitizer (LSAN)</a>
 to check for memory errors. To enable ASAN and LSAN, configure CMake in
 debug mode and run tests as you normally would. If there is memory 
error, you will see a memory error report. Note that macOS <strong>only supports address sanitizer without leak sanitizer</strong>.</p>
<p>In some cases, address sanitizer might affect the usability of the 
debugger. In this case, you might need to disable all sanitizers by 
configuring the CMake project with:</p>
<pre class="border border-2 shadow-sm p-2">$ cmake -DCMAKE_BUILD_TYPE=Debug -DBUSTUB_SANITIZER= ..
</pre>

<h2>Development Hints</h2>
<p>You can use <code>BUSTUB_ASSERT</code> for assertions in debug mode. Note that the statements within <code>BUSTUB_ASSERT</code> will NOT be executed in release mode.
If you have something to assert in all cases, use <code>BUSTUB_ENSURE</code> instead.</p>
<p class="warning bg-danger text-white p-2 rounded fw-bold">
    <i class="trigger fa fa-question-circle fa-lg p-1 pe-lg-2"></i>
    Post all of your questions about this project on Piazza. Do <u><b>not</b></u> email the TAs directly with questions.
</p>

<p>We encourage you to use a graphical debugger to debug your project if you are having problems.</p>
<p>If you are having compilation problems, running <code>make clean</code> does not completely reset the compilation process. You will need to delete your build directory and run <code>cmake ..</code> again before you rerun <code>make</code>.</p>
<!-- ========================================================================= -->
<!-- GRADING RUBRIC                                                            -->
<!-- ========================================================================= -->
<h1 id="grading">Grading Rubric</h1>
<p>Each project submission will be graded based on the following criteria:</p>
<ol class="default">
    <li> Does the submission successfully execute all of the test cases and produce the correct answer?
    </li><li> Does the submission execute without any memory leaks?
    </li><li> Does the submission follow the code formatting and style policies?
</li></ol>

<p>Note that we will use additional test cases to grade your submission 
that are more complex than the sample test cases that we provide you.</p>
<!-- ========================================================================= -->
<!-- LATE POLICY                                                               -->
<!-- ========================================================================= -->
<!-- <h1 id="submission">Late Policy</h1>

<p>You will lose 10% of the points for a project for every 24 hours it is late.</p>
 --><!-- ========================================================================= -->
<!-- SUBMISSION                                                                -->
<!-- ========================================================================= -->
<h1 id="submission">Submission</h1>

<p>After April 15, once you’ve completed the assignment, you may submit your implementation to Gradescope.</p>
<ul>
<li> Enroll the course with entry code: B3KZW2. 
<li>Submit via <b><a onclick="javascript:pageTracker._trackPageview('/outgoing/www.gradescope.com');" href="https://www.gradescope.com/courses/1017705">https://www.gradescope.com/courses/1017705</a></b></li>
</ul>
<p>Running <code>make submit-p1</code> in your <code>build/</code> directory will generate a <code>zip</code> archive called <code>project1-submission.zip</code> under your project root directory. <p> Under the root directory, run 
    <code> python3 gradescope_sign.py </code> 
    to sign on the generated <code>project1-submission.zip</code>, then you can submit the zip file to Gradescope.</p>
<p>You can submit your answers as many times as you like and get immediate feedback.</p>
<h2>Notes on Gradescope and Autograder</h2>
<ol>
<li>If you are timing out on Gradescope, it's likely because you have a 
deadlock in your code or your code is too slow and does not run in 60 
seconds. If your code is too slow it may be because your <code>LRUKReplacer</code> is not efficient enough.</li>
<li>The autograder will not work if you are printing too many logs in your submissions.</li>
<li>If the autograder did not work properly, make sure that your 
formatting commands work and that you are submitting the right files.</li>
<!-- <li>The leaderboard benchmark score will be calculated by stress testing your <code>buffer_pool_manager</code> implementation.</li> -->
</ol>
<p class="warning bg-danger text-white p-2 rounded fw-bold">
    <i class="trigger fa fa-question-circle fa-lg p-1 pe-lg-2"></i>
    <!-- CMU students should use the Gradescope course code announced on Piazza. -->
</p>

<!-- ========================================================================= -->
<!-- COLLABORATION POLICY
<!-- ========================================================================= -->
<h1 id="collaboration">Collaboration Policy</h1>

<ul>
<li>Every student has to work individually on this assignment.</li>
<li>Students are allowed to discuss high-level details about the project with others.</li>
<li>Students are <strong>not</strong> allowed to copy the contents of a white-board after a group meeting with other students.</li>
<li>Students are <strong>not</strong> allowed to copy the solutions from another colleague.</li>
</ul>
<p class="warning bg-danger text-white p-2 rounded fw-bold">
    <i class="trigger fa fa-exclamation-triangle fa-lg p-1 pe-lg-2"></i>
    <b>WARNING:</b> All of the code for this project must be your own. 
You may not copy source code from other students or other sources that 
you find on the web. Plagiarism <b>will not</b> be tolerated. 
</p>
        </div>
        <!-- END: main -->
    </main>

<!-- Footer -->
   <!-- Google Analytics -->
    <script async="" src="Project%20%231%20-%20Buffer%20Pool%20Manager%20_%20CMU%2015-445_645%20__%20Intro%20to%20Database%20Systems%20(Spring%202025)_files/js"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    gtag('config', 'G-T6CTRQK4NY');
    </script>
    <!-- End Google Analytics Code -->

<!--     <script src="js/bootstrap.bundle.min.js"></script> -->

<!--     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script> -->
<!--     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script> -->

    <script src="Project%20%231%20-%20Buffer%20Pool%20Manager%20_%20CMU%2015-445_645%20__%20Intro%20to%20Database%20Systems%20(Spring%202025)_files/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>



</body></html>